<div mat-dialog-title class="text-center">
    <h2>Aggiungi un gioco</h2>
</div>
<div mat-dialog-content>
    <div *ngIf="!isLoading">
        <div *ngIf="step == 1">
            <form [formGroup]="aggiungiGiocoForm">
                <div class="py-3">
                    <label class="py-3 fs-2">Nome</label>
                    <input type="text" placeholder="Inserisci un nome" formControlName="nomeGioco" class="form-control">
                    <p class="text-danger fs-5 py-1"
                        *ngIf="aggiungiGiocoForm.controls['nomeGioco'].touched && aggiungiGiocoForm.controls['nomeGioco'].invalid">
                        Inserisci il nome
                    </p>
                    <p class="text-success fs-5 py-1"
                        *ngIf="aggiungiGiocoForm.controls['nomeGioco'].touched && aggiungiGiocoForm.controls['nomeGioco'].valid">
                        Corretto <i class="pi pi-check" style="color: green"></i>
                    </p>
                </div>
                <div class="py-3">
                    <label class="py-3 fs-2">Descrizione</label>
                    <textarea type="text" placeholder="Inserisci una descrizione" formControlName="descrizione"
                        class="form-control">
        </textarea>
                    <p class="text-danger fs-5 py-1"
                        *ngIf="aggiungiGiocoForm.controls['descrizione'].touched && aggiungiGiocoForm.controls['descrizione'].invalid">
                        Inserisci una descrizione corretta, massimo 120 caratteri.
                    </p>
                    <p class="text-success fs-5 py-1"
                        *ngIf="aggiungiGiocoForm.controls['descrizione'].touched && aggiungiGiocoForm.controls['descrizione'].valid">
                        Corretto <i class="pi pi-check" style="color: green"></i>
                    </p>
                </div>
            </form>
            <div class="py-3">
                <label class="py-3 fs-2">Livello di difficolt√†</label>
                <div>
                    <input type="number" max="5" #difficolta [(ngModel)]="value" class="form-control mb-4"
                        (click)="difficoltaTouched = true;" />
                    <p-slider [(ngModel)]="value" max="5" min="0" class="w-full"
                        (onChange)="difficoltaTouched = true;" />
                </div>
                <div *ngIf="difficolta.value" class="d-flex justify-content-evenly py-3">
                    <img src="assets/home/star.png" alt="star" [style.width]="'30px'" [style.height]="'30px'"
                        *ngFor="let s of stars index as i" [ngClass]="i<number(difficolta.value)?'':'d-none'">
                </div>
                <p class="text-danger fs-5 py-3"
                    *ngIf="difficoltaTouched&&(number(difficolta.value) > 5 || number(difficolta.value)<=0)">
                    Minimo 1, massimo 5.
                </p>
                <p class="text-success fs-5 py-3" *ngIf="number(difficolta.value) <= 5 && number(difficolta.value)>0">
                    Corretto <i class="pi pi-check" style="color: green"></i>
                </p>
            </div>
        </div>
        <div *ngIf="step == 2">
            <button class="btn" matTooltip="Seleziona un'immagine" matTooltipPosition="above" (click)="image.click()">
                <i class="pi pi-plus" style="font-size: 1.5rem;"></i>
            </button> <span class="fs-2">Inserisci un'immagine</span>
            <input type="file" #image class="d-none" (change)="handleImageEvent($event)"
                accept="image/png, image/gif, image/jpeg" id="image">
            <div *ngIf="!selectedImage" class="w-100 border shadow-sm to-point" [style.height]="'200px'"
                (click)="image.click()">
            </div>
            <div class="text-end" *ngIf="selectedImage ">
                <button class="btn" matTooltip="Elimina" matTooltipPosition="above" (click)="cleanImage()">
                    <i class="pi pi-trash" style="font-size: 1.5rem; color: red;"></i>
                </button>
            </div>
            <div id="uploadedImage" *ngIf="selectedImage" [style.height]="'200px'"
                style.backgroundImage="url('{{imageUrl}}')" class="w-100 border shadow-sm to-point"
                (click)="image.click()">
            </div>
            <p class="fs-5 text-danger py-2" *ngIf="!selectedImage">Carica un'immagine per andare avanti
            </p>
            <p class="fs-5 text-success py-2" *ngIf="selectedImage">Corretto <i class="pi pi-check"
                    style="color: green"></i>
            </p>
            <div class="py-5">
                <p class="fs-2">Scegli una categoria</p>
                <div class="w-100 justify-center my-3">
                    <p-autocomplete [(ngModel)]="valueCategory" [suggestions]="categorieNames"
                        class="bg-white text-dark w-100 d-flex justify-content-center"
                        (completeMethod)="searchCategories($event)" (onSelect)="addCategory(valueCategory)" />
                </div>
                <div class="py-2 fs-4" *ngFor="let c of choosedCategories index as i">
                    <span class="fs-2 fw-bold">{{i+1}}</span> - {{c?.nome}} <span><i class="pi pi-trash"
                            style="font-size: 1.5rem; color: red;cursor: pointer;" matTooltip="Elimina"
                            matTooltipPosition="right" (click)="removeCategory(c)"></i></span>
                </div>
                <p class="fs-5 text-danger py-2" *ngIf="choosedCategories.size ==0">Scegli almeno una categoria per
                    andare
                    avanti
                </p>
                <p class="fs-5 text-success py-2" *ngIf="choosedCategories.size>0">Corretto <i class="pi pi-check"
                        style="color: green"></i></p>
            </div>
        </div>
        <div *ngIf="step == 3" class="row py-3 step-3">
            <div class="col-12">
                <p class="fs-2">Riepilogo</p>
            </div>
            <div class="col-md-6 py-2">
                <div class="w-100 border shadow-sm to-point" [style.height]="'200px'"
                    style.backgroundImage="url({{imageUrl}})"></div>
            </div>
            <div class="col-6">
                <div class="row">
                    <div class="col-md-6 py-2">
                        <p class="fs-3"><span class="text-success">Nome gioco : </span>
                            {{aggiungiGiocoForm.controls['nomeGioco'].value}}</p>
                    </div>
                    <div class="col-md-6 py-2">
                        <p class="fs-3"><span class="text-success">Difficolta : </span>
                            {{value}}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-12 py-2">
                <p class="fs-3"><span class="text-success">Descrizione : </span>
                    {{aggiungiGiocoForm.controls['descrizione'].value}}</p>
            </div>
            <div class="col-12">
                <p class="fs-3"><span class="text-success">Categorie : </span>
                </p>
                <p class="m-2 border p-2 shadow-sm fs-3" *ngFor="let c of choosedCategories index as i">
                    <span class="fs-1 fw-bold">{{i+1}}</span> - {{c.nome}}
                </p>
            </div>
        </div>
    </div>
    <div *ngIf="isLoading">
        <mat-spinner color="warn" class="m-auto"></mat-spinner>
    </div>
    <div class="d-flex justify-content-center my-3" *ngIf="!isLoading">
        <button class="btn mx-1" *ngIf="step>1" (click)="step=step-1">
            <i class="pi pi-arrow-left" style="font-size: 2rem;"></i>
        </button>
        <button class="btn mx-1" *ngIf="(step==1 && aggiungiGiocoForm.valid && value>0 && value<6) ||
            (step==2 &&selectedImage && choosedCategories.size>0)" (click)="step=step+1">
            <i class="pi pi-arrow-right" style="font-size: 2rem;"></i>
        </button>
        <button class="btn btn-outline-success" *ngIf="step == 3" matTooltip="Conferma" matTooltipPosition="above"
            (click)="confirm()">Conferma</button>
    </div>
</div>
<div mat-dialog-actions></div>
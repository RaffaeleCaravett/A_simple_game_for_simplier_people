<nav class="pt-3 text-center" [ngClass]="mode=='light'?'bg-personal':'bg-personal-opposite'">
    <div class="container">
        <div class="row" *ngIf="innerWidth >767.20 else shortMenu">
            <div class="col-md-12 text-end mode" *ngIf="notificationToRead!=null">
                <button class="btn text-light light fs-4" (click)="updateMode('light')" *ngIf="mode=='dark'">
                    LIGHT MODE ‚òÄÔ∏è
                </button>
                <button class="btn text-dark dark fs-4" (click)="updateMode('dark')" *ngIf="mode=='light'">
                    DARK MODE üåô
                </button>
                <span *ngIf="user" (click)="openNotificationMenu();" class="position-relative"><i
                        class="bi bi-bell h2 text-danger"
                        title="{{notificationToRead>0?'':'0 notifiche da leggere!'}}"></i>
                    <span class="bg-secondary text-white rounded shadow-sm position-absolute new-notification"
                        *ngIf="notificationToRead>0"
                        title="{{notificationToRead}} {{notificationToRead ==1?'notifica':'notifiche'}} da leggere!">new</span>
                </span>
            </div>
            <div class=" col-md-12 d-flex justify-content-end" *ngIf="notificationToRead == null">
                <mat-spinner diameter="50" color="warn" strokeWidth="4"></mat-spinner>
            </div>
            <div class="col-md-12 d-flex justify-content-end position-relative" *ngIf="notificationMenuOpen">
                <div class="w-25 bg-light border rounded shadow position-absolute notification-menu">
                    <div class="py-5 text-center" *ngIf="notifications.length==0">
                        <p class="fs-4">
                            Non ci sono notifiche da leggere.
                        </p>
                    </div>
                    <div class="row" [style.cursor]="'pointer'"
                        [ngClass]="n.state=='SENT'?'bg-secondary bg-gradient':'bg-white'"
                        [style.borderBottom]="'1px solid lightgray'" *ngFor="let n of notifications"
                        (click)="openNotification(n)">
                        <div class="col-2">
                            <img src="{{n.sender.immagineProfilo}}"
                                class="rounded-circle border shadow notification-pic"
                                alt="immagine_profilo_notificatore">
                        </div>
                        <div class="col-8">
                            <p>{{n.testo}}</p>
                            <p>{{n.createdAt}}</p>
                        </div>
                        <div class="col-1">
                            <i class="bi bi-check2-all" title="letta" *ngIf="n.state=='READ'"></i>
                            <i class="bi bi-check2" title="non letta" *ngIf="n.state=='SENT'"></i>
                            <br>
                            <i class="bi bi-envelope-fill" *ngIf="n.notificationType=='MESSAGE'" title="Messaggio"></i>
                            <i class="bi bi-person-lines-fill" title="Richiesta di contatto"
                                *ngIf="n.notificationType=='CONNECTION_REQUEST'"></i>
                            <i class="bi bi-envelope-at" title="Email" *ngIf="n.notificationType=='EMAIL'"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <button class="btn fs-4" [ngClass]="mode!='light'?'text-light':'text-dark'" [routerLink]="'/home'"
                    (click)="closeMenu(pTrigger);notificationMenuOpen = false;
                notificationMenuOpen = false;">üè†
                    HOME</button>
            </div>
            <div class="col-md-4">
                <button class="btn fs-4" *ngIf="isAuthenticatedUser" [ngClass]="mode!='light'?'text-light':'text-dark'"
                    [routerLink]="'/lobby'" (click)="closeMenu(pTrigger);notificationMenuOpen = false;
                    notificationMenuOpen = false;">üéÆ LOBBY</button>
            </div>
            <div class="col-md-4" *ngIf="!isAuthenticatedUser;else logOut">
                <button class="btn fs-4" [ngClass]="mode!='light'?'text-light':'text-dark'" [routerLink]="'/forms'"
                    (click)="closeMenu(pTrigger);notificationMenuOpen = false;
                notificationMenuOpen = false;">üö™
                    LOGIN</button>
            </div>
            <ng-template #logOut>
                <div class="col-md-4" *ngIf="isAuthenticatedUser">
                    <div class="d-flex flex-column justify-content-center align-items-center"
                        *ngIf="null!=user&&undefined!=user">
                        <div class="w-auto d-flex flex-column justify-content-center align-items-center"
                            *ngIf="!isLoadingLogoutOrRoute else isLoading">
                            <div class="rounded-circle shadow to-point profile-pic m-auto mat-trigger"
                                (click)="p.click()" style.backgroundImage="url('{{user!.immagineProfilo}}')"></div>
                            <div class="d-flex">
                                <button class="btn" [matMenuTriggerFor]="appMenu"
                                    [ngClass]="mode!='light'?'text-light':'text-dark'" #p #pTrigger="matMenuTrigger"
                                    (click)="notificationMenuOpen = false">{{user.fullName}} </button>
                                <span title="Online" *ngIf="user.isConnected"
                                    class="login-span border rounded-circle mx-1 mt-2"></span>
                                <span title="Online" *ngIf="!user.isConnected"
                                    class="login-span border bg-danger rounded-circle mx-1 mt-2"></span>
                            </div>
                        </div>
                        <ng-template #isLoading>
                            <app-spinner [width]="100" [height]="100" [baseColor]="'blue'"></app-spinner>
                        </ng-template>
                    </div>
                </div>
                <mat-menu #appMenu="matMenu" class="overflow-hidden">
                    <ng-template matMenuContent>
                        <div>
                            <button mat-menu-item class="btn fs-4 text-dark" (click)="goToRoute('lobby/profile')">ü™™
                                Profile</button>
                            <button mat-menu-item class="btn fs-4 text-dark" (click)="goToRoute('lobby/preferiti')">üíå
                                Preferiti</button>
                            <button mat-menu-item class="btn fs-4 text-dark" (click)="goToRoute('lobby/chat')">üí¨
                                Chat</button>
                            <button mat-menu-item class="btn fs-4 text-dark" (click)="goToRoute('amministrazione')"
                                *ngIf="user?.email=='raffaelecaravetta13@gmail.com'">üè¢ Amministrazione</button>
                            <button mat-menu-item class="btn fs-4 text-dark" (click)="logout()"
                                [routerLink]="'/home'">‚û°Ô∏è Logout</button>
                        </div>
                    </ng-template>
                </mat-menu>
            </ng-template>
        </div>
        <ng-template #shortMenu>
            <div class="row">
                <div class="col-md-12 text-end mode" *ngIf="notificationToRead!=null">
                    <button class="btn text-light light fs-4" (click)="updateMode('light')" *ngIf="mode=='dark'">
                        LIGHT MODE ‚òÄÔ∏è
                    </button>
                    <button class="btn text-dark dark fs-4" (click)="updateMode('dark')" *ngIf="mode=='light'">
                        DARK MODE üåô
                    </button>
                    <span *ngIf="user" (click)="openNotificationMenu();" class="position-relative"><i
                            class="bi bi-bell h2 text-danger"
                            title="{{notificationToRead>0?'':'0 notifiche da leggere!'}}"></i>
                        <span class="bg-secondary text-white rounded shadow-sm position-absolute new-notification"
                            *ngIf="notificationToRead>0"
                            title="{{notificationToRead}} {{notificationToRead ==1?'notifica':'notifiche'}} da leggere!">new</span>
                    </span>
                </div>
                <div class="col-md-12 d-flex justify-content-end" *ngIf="notificationToRead == null">
                    <mat-spinner diameter="50" color="warn" strokeWidth="4"></mat-spinner>
                </div>
                <div class="col-md-12 d-flex justify-content-end position-relative" *ngIf="notificationMenuOpen">
                    <div class="w-75 bg-light shadow border rounded position-absolute notification-menu">
                        <div class="py-5 text-center" *ngIf="notifications.length==0">
                            <p class="fs-4">
                                Non ci sono notifiche da leggere.
                            </p>
                        </div>
                        <div class="row" [style.cursor]="'pointer'" [ngClass]="n.state=='SENT'?'bg-secondary bg-gradient':'bg-white'"
                            [style.borderBottom]="'1px solid lightgray'" *ngFor="let n of notifications"
                            (click)="openNotification(n)">
                            <div class="col-2">
                                <img src="{{n.sender.immagineProfilo}}"
                                    class="rounded-circle border shadow notification-pic"
                                    alt="immagine_profilo_notificatore">
                            </div>
                            <div class="col-8">
                                <p>{{n.testo}}</p>
                                <p>{{n.createdAt}}</p>
                            </div>
                            <div class="col-1">
                                <i class="bi bi-envelope" *ngIf="n.state=='READ'"></i>
                                <i class="bi bi-envelope-fill" *ngIf="n.state=='SENT'"></i>
                                <i class="bi bi-envelope-fill" *ngIf="n.notificationType=='MESSAGE'"
                                    title="Messaggio"></i>
                                <i class="bi bi-person-lines-fill" title="Richiesta di contatto"
                                    *ngIf="n.notificationType=='CONNECTION_REQUEST'"></i>
                                <i class="bi bi-envelope-at" title="Email" *ngIf="n.notificationType=='EMAIL'"></i>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-4">
                    <button class="btn fs-4" [ngClass]="mode!='light'?'text-light':'text-dark'" [routerLink]="'/home'"
                        (click)="closeMenu(p1Trigger);
                notificationMenuOpen = false;" title="Home">üè†</button>
                </div>
                <div class="col-4">
                    <button class="btn fs-4" *ngIf="isAuthenticatedUser"
                        [ngClass]="mode!='light'?'text-light':'text-dark'" [routerLink]="'/lobby'" (click)="closeMenu(p1Trigger);
                notificationMenuOpen = false" title="Lobby">üéÆ</button>
                </div>
                <div class="col-4" *ngIf="!isAuthenticatedUser;else logOut">
                    <button class="btn fs-4" [ngClass]="mode!='light'?'text-light':'text-dark'" [routerLink]="'/forms'"
                        (click)="closeMenu(p1Trigger);
                notificationMenuOpen = false;" title="Login">üö™</button>
                </div>
                <ng-template #logOut>
                    <div class="col-4" *ngIf="isAuthenticatedUser">
                        <div class="d-flex flex-column justify-content-center align-items-center"
                            *ngIf="null!=user&&undefined!=user">
                            <div class="w-auto d-flex flex-column justify-content-center align-items-center"
                                *ngIf="!isLoadingLogoutOrRoute else isLoading">
                                <div class="rounded-circle shadow to-point profile-pic m-auto mat-trigger"
                                    (click)="p1.click()" style.backgroundImage="url('{{user!.immagineProfilo}}')"></div>
                                <button class="btn" [matMenuTriggerFor]="appMenu" #p1 #p1Trigger="matMenuTrigger"
                                    (click)="notificationMenuOpen = false"></button>
                            </div>
                            <ng-template #isLoading>
                                <app-spinner [width]="100" [height]="100" [baseColor]="'blue'"></app-spinner>
                            </ng-template>
                        </div>
                    </div>
                    <mat-menu #appMenu="matMenu" class="overflow-hidden">
                        <ng-template matMenuContent>
                            <div>
                                <button mat-menu-item class="btn fs-4 text-dark" (click)="goToRoute('lobby/profile')">ü™™
                                    Profile</button>
                                <button mat-menu-item class="btn fs-4 text-dark"
                                    (click)="goToRoute('lobby/preferiti')">üíå Preferiti</button>
                                <button mat-menu-item class="btn fs-4 text-dark" (click)="goToRoute('lobby/chat')">üí¨
                                    Chat</button>
                                <button mat-menu-item class="btn fs-4 text-dark" (click)="goToRoute('amministrazione')"
                                    *ngIf="user?.email=='raffaelecaravetta13@gmail.com'">üè¢ Amministrazione</button>
                                <button mat-menu-item class="btn fs-4 text-dark" (click)="logout()"
                                    [routerLink]="'/home'">‚û°Ô∏è Logout</button>
                            </div>
                        </ng-template>
                    </mat-menu>
                </ng-template>
            </div>
        </ng-template>
    </div>
</nav>